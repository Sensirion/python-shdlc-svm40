include: https://gitlab/Sensirion/Python/ci-config-python/raw/master/gitlab-ci-template-v2.yml

check_rst_syntax:
  extends: .check_rst_syntax_v2

check_editorconfig:
  extends: .check_editorconfig_v2

py2p7_linux_build:
  extends: .py2p7_linux_build_v2
  variables:
    PYTEST_ADDOPTS: '-m "not needs_device"'

py3p5_linux_build:
  extends: .py3p5_linux_build_v2
  variables:
    PYTEST_ADDOPTS: '-m "not needs_device"'


py2p7_32bit_win_build:
  extends: .py2p7_32bit_win_docker_build_v2
  variables:
    PYTEST_ADDOPTS: '-m "not needs_device"'

py3p5_64bit_win_build:
  extends: .py3p5_64bit_win_docker_build_v2
  variables:
    PYTEST_ADDOPTS: '-m "not needs_device"'


build_docs:
  extends: .build_docs_v2
  script:
    - apt-get update && apt-get install -y graphviz
    - python setup.py install
    - pip install -r docs/requirements.txt
    - sphinx-versioning build -r "$CI_COMMIT_REF_NAME" -w "$CI_COMMIT_REF_NAME" docs docs/_build/html
  after_script:
    - mv docs/_build/html/ public/  # everything in public/ will get published


deploy_staging:
  extends: .deploy_staging_v2

deploy_stable:
  extends: .deploy_stable_v2


# Deploy all files within the "public" directory of the artifacts from the jobs
# specified as dependencies. Job must be named pages, otherwise gitlab does
# not deploy to gitlab pages.
pages:
  extends: .deploy_pages_v2
  dependencies: [build_docs]
